;(function(){var preloaded_source={'jsio.std.base64':{"url":"jsio/std/base64.js","src":"\njsio('import logging');var logger=logging.getLogger('base64');var alphabet='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdef'+'ghijklmnopqrstuvwxyz0123456789-_';var pad='=';var shorten=function(array,number){for(var i=number;i>0;i--){array.pop();};};var decode_map={};for(var i=0,n=alphabet.length;i<n;i++){decode_map[alphabet.charAt(i)]=i;};var alphabet_inverse=new RegExp('[^'+alphabet+']');var Base64CodecError=exports.Base64CodecError=function(message){this.message=message;};Base64CodecError.prototype.toString=function(){return'Base64CodecError'+(this.message?': '+this.message:'');};var assertOrBadInput=function(exp,message){if(!exp){throw new Base64CodecError(message)};};exports.encode=function(bytes){assertOrBadInput(!(/[^\\x00-\\xFF]/.test(bytes)),'Input contains out-of-range characters.');var padding='\\x00\\x00\\x00'.slice((bytes.length%3)||3);bytes+=padding;var out_array=[];for(var i=0,n=bytes.length;i<n;i+=3){var newchars=((bytes.charCodeAt(i)<<020)+\n(bytes.charCodeAt(i+1)<<010)+\n(bytes.charCodeAt(i+2)));out_array.push(alphabet.charAt((newchars>>18)&077),alphabet.charAt((newchars>>12)&077),alphabet.charAt((newchars>>6)&077),alphabet.charAt((newchars)&077));};shorten(out_array,padding.length);return out_array.join('');};exports.decode=function(b64text){logger.debug('decode',b64text);b64text=b64text.replace(/\\s/g,'')\nvar i=b64text.length;while(b64text[--i]===pad){};b64text=b64text.slice(0,i+1);assertOrBadInput(!alphabet_inverse.test(b64text),'Input contains out-of-range characters.');var padding=Array(5-((b64text.length%4)||4)).join(alphabet[alphabet.length-1]);b64text+=padding;var out_array=[];for(var i=0,n=b64text.length;i<n;i+=4){newchars=((decode_map[b64text.charAt(i)]<<18)+\n(decode_map[b64text.charAt(i+1)]<<12)+\n(decode_map[b64text.charAt(i+2)]<<6)+\n(decode_map[b64text.charAt(i+3)]));out_array.push((newchars>>020)&0xFF,(newchars>>010)&0xFF,(newchars)&0xFF);};shorten(out_array,padding.length);var result=String.fromCharCode.apply(String,out_array);logger.debug('decoded',result);return result;};"},'jsio.std.uri':{"url":"jsio/std/uri.js","src":"\njsio('import Class, bind')\njsio('import logging');var logger=logging.getLogger('uri');var attrs=[\"source\",\"protocol\",\"authority\",\"userInfo\",\"user\",\"password\",\"host\",\"port\",\"relative\",\"path\",\"directory\",\"file\",\"query\",\"anchor\"];exports.Uri=Class(function(supr){this.init=function(url,isStrict){var uriData=exports.parse(url,isStrict)\nfor(attr in uriData){this['_'+attr]=uriData[attr];}}\nfor(var i=0,attr;attr=attrs[i];++i){(function(attr){var fNameSuffix=attr.charAt(0).toUpperCase()+attr.slice(1);this['get'+fNameSuffix]=function(){return this['_'+attr];}\nthis['set'+fNameSuffix]=function(val){this['_'+attr]=val;}}).call(this,attr);}\nthis.render=function(){return this._source;}})\nvar strictRegex=/^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/;var looseRegex=/^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/;var queryStringRegex=/(?:^|&)([^&=]*)=?([^&]*)/g;exports.parse=function(str,isStrict){var regex=isStrict?strictRegex:looseRegex;var result={}\nvar match=regex.exec(str);for(var i=0,attr;attr=attrs[i];++i){result[attr]=match[i]||\"\";}\nvar qs=result['queryKey']={}\nresult['query'].replace(queryStringRegex,function(check,key,val){if(check){qs[key]=val;}})\nreturn result;}\nexports.isSameDomain=function(urlA,urlB){var a=exports.parse(urlA);var b=exports.parse(urlB);return((urlA.port==urlB.port)&&(urlA.host==urlB.host)&&(urlA.protocol=urlB.protocol))}"},'jsio.std.utf8':{"url":"jsio/std/utf8.js","src":"\nexports.UnicodeCodecError=function(message){this.message=message;};var UnicodeCodecError=exports.UnicodeCodecError;UnicodeCodecError.prototype.toString=function(){return'UnicodeCodecError'+(this.message?': '+this.message:'');};exports.encode=function(unicode_string){try{return unescape(encodeURIComponent(unicode_string));}\ncatch(err){throw new UnicodeCodecError('invalid input string');};};exports.decode=function(bytes){if(/[^\\x00-\\xFF]/.test(bytes)){throw new UnicodeCodecError('invalid utf-8 bytes');};var len,len_parsed;len=len_parsed=bytes.length;var last=len-1;if(bytes.charCodeAt(last)>=0x80){for(var i=1;i<=3;i++){if(bytes.charCodeAt(len-i)>=0xC0){len_parsed=len-i;break;};};try{decodeURIComponent(escape(bytes.slice(len_parsed)));len_parsed=len;}\ncatch(err){};};try{return[decodeURIComponent(escape(bytes.slice(0,len_parsed))),len_parsed];}\ncatch(err){throw new UnicodeCodecError('invalid utf-8 bytes');};};"},'logging':{"url":"jsio/logging.js","src":"\njsio('import Class, bind, log');var loggers={}\nvar levels=exports.levels={DEBUG:0,LOG:1,INFO:2,WARN:3,ERROR:4};var production=false;exports.setProduction=function(prod){production=!!prod;}\nexports.getLogger=function(name){if(!(name in loggers)){loggers[name]=new exports.Logger(name);}\nreturn loggers[name];}\nexports.Logger=Class(function(){this.init=function(name,level){if(!level){level=levels.LOG;}\nthis.name=name;this.level=level;}\nthis.setLevel=function(level){this.level=level;}\nfunction makeLogFunction(level,type){return function(){if(level<this.level||production)return;log.apply(log,[type,this.name].concat(Array.prototype.slice.call(arguments,0)));}}\nthis.debug=makeLogFunction(levels.DEBUG,\"DEBUG\");this.log=makeLogFunction(levels.LOG,\"LOG\");this.info=makeLogFunction(levels.INFO,\"INFO\");this.warn=makeLogFunction(levels.WARN,\"WARN\");this.error=makeLogFunction(levels.ERROR,\"ERROR\");})"},'jsio.protocols.delimited':{"url":"jsio/protocols/delimited.js","src":"\njsio('import Class, log, logging, jsio.interfaces');var logger=logging.getLogger('DelimitedProtocol')\nexports.DelimitedProtocol=Class(jsio.interfaces.Protocol,function(supr){this.init=function(delimiter){if(!delimiter){delimiter='\\r\\n'}\nthis.delimiter=delimiter;this.buffer=\"\"}\nthis.connectionMade=function(){logger.debug('connectionMade');}\nthis.dataReceived=function(data){logger.debug('dataReceived:('+data.length+')',data);logger.debug('last 2:',data.slice(data.length-2));this.buffer+=data;logger.debug('index',this.buffer.indexOf(this.delimiter));var i;while((i=this.buffer.indexOf(this.delimiter))!=-1){var line=this.buffer.slice(0,i);this.buffer=this.buffer.slice(i+this.delimiter.length);this.lineReceived(line);}}\nthis.lineReceived=function(line){logger.debug('Not implemented, lineReceived:',line);}\nthis.connectionLost=function(){logger.debug('connectionLost');}});"},'jsio.env':{"url":"jsio/env.js","src":"\njsio('import log, bind');function getObj(objectName,transportName,envName){jsio('from .env.'+(envName||jsio.__env)+'.'+transportName+' import '+objectName+' as result');return result;}\nexports.getListener=bind(this,getObj,'Listener');exports.getConnector=bind(this,getObj,'Connector');"},'jsio.csp.errors':{"url":"jsio/csp/errors.js","src":"\nvar makeErrorClass=function(name,_code){var out=function(message,code){this.message=message;this.code=code||_code;}\nout.prototype.toString=function(){return name+(this.message?': '+this.message:'');}\nreturn out;}\nexports.ReadyStateError=makeErrorClass(\"ReadyStateError\");exports.InvalidEncodingError=makeErrorClass(\"InvalidEncodingError\");exports.HandshakeTimeout=makeErrorClass(\"HandshakeTimeout\",100);exports.SessionTimeout=makeErrorClass(\"HandshakeTimeout\",101);exports.ServerProtocolError=makeErrorClass(\"ServerProtocolError\",200);"},'jsio.csp.transports':{"url":"jsio/csp/transports.js","src":"\njsio('import Class, bind');jsio('import jsio.std.uri as uri');jsio('import jsio.std.base64 as base64');jsio('import logging');jsio('import .errors');var logger=logging.getLogger(\"csp.transports\");exports.allTransports={}\nexports.registerTransport=function(name,transport){logger.debug('registering transport',name);if(name in exports.allTransports){throw new Error(\"Transport \"+name+\" already exists\");}\nexports.allTransports[name]=transport;}\nexports.chooseTransport=function(url,options){return exports.allTransports.jsonp;var test=location.toString().match('file://');if(test&&test.index===0){logger.debug('Detected Local file, choosing transport jsonp')\nreturn exports.allTransports.jsonp}\nif(uri.isSameDomain(url,location.toString())){logger.debug('Detected same domain, chosing transport xhr');return exports.allTransports.xhr;}\ntry{if(window.XMLHttpRequest&&(new XMLHttpRequest()).withCredentials!==undefined){logger.debug('Detected cross-domain; detected xdomain xhr capabilities; choosing transport xhr');return exports.allTransports.xhr;}}catch(e){}\nlogger.debug('Detected cross-domain; no xdomain xhr capabilities present; choosing transport jsonp');return exports.allTransports.jsonp}\nvar PARAMS={'xhrstream':{\"is\":\"1\",\"bs\":\"\\n\"},'xhrpoll':{\"du\":\"0\"},'xhrlongpoll':{},'sselongpoll':{\"bp\":\"data: \",\"bs\":\"\\r\\n\",\"se\":\"1\"},'ssestream':{\"bp\":\"data: \",\"bs\":\"\\r\\n\",\"se\":\"1\",\"is\":\"1\"}};exports.Transport=Class(function(supr){this.handshake=function(url,options){throw new Error(\"handshake Not Implemented\");}\nthis.comet=function(url,sessionKey,lastEventId,options){throw new Error(\"comet Not Implemented\");}\nthis.send=function(url,sessionKey,data,options){throw new Error(\"send Not Implemented\");}\nthis.encodePacket=function(packetId,data,options){throw new Error(\"encodePacket Not Implemented\");}\nthis.abort=function(){throw new Error(\"abort Not Implemented\");}})\nexports.registerTransport('xhr',Class(exports.Transport,function(supr){}));exports.registerTransport('jsonp',Class(exports.Transport,function(supr){var logger=logging.getLogger('csp.transports.jsonp');function createIframe(){var i=document.createElement(\"iframe\");i.style.display='block';i.style.width='0';i.style.height='0';i.style.border='0';i.style.margin='0';i.style.padding='0';i.style.overflow='hidden';i.style.visibility='hidden';i.cbId=0;document.body.appendChild(i);return i;}\nthis.init=function(){this._ifr={'send':createIframe(),'comet':createIframe()};}\nthis.handshake=function(url,options){logger.debug('handshake:',url,options);args={d:\"{}\"}\nthis._makeRequest('send',url+'/handshake',args,this.handshakeSuccess,this.handshakeFailure);}\nthis.comet=function(url,sessionKey,lastEventId,options){logger.debug('comet:',url,sessionKey,lastEventId,options);args={s:sessionKey,a:lastEventId}\nthis._makeRequest('comet',url+'/comet',args,this.cometSuccess,this.cometFailure);}\nthis.send=function(url,sessionKey,data,options){logger.debug('send:',url,sessionKey,data,options);args={d:data,s:sessionKey}\nthis._makeRequest('send',url+'/send',args,this.sendSuccess,this.sendFailure);}\nthis.encodePacket=function(packetId,data,options){return[packetId,1,base64.encode(data)]}\nthis._makeRequest=function(rType,url,args,cb,eb){args.n=Math.random();window.setTimeout(bind(this,function(){var ifr=this._ifr[rType];var doc=ifr.contentDocument||ifr.contentWindow.document||ifr.document;var win=ifr.contentWindow\nvar head=doc.getElementsByTagName('head')[0]||doc.getElementsByTagName('body')[0];var errorSuppressed=false;var jsonpId=ifr.cbId++;win['eb'+jsonpId]=function errback(isIe){logger.debug('in eb');if(!errorSuppressed){logger.debug('error making request:',fullUrl);}\nif(!isIe){logger.debug('removing scripts');var scripts=doc.getElementsByTagName('script');var s1=doc.getElementsByTagName('script')[0];var s2=doc.getElementsByTagName('script')[1];s1.parentNode.removeChild(s1);s2.parentNode.removeChild(s2);logger.debug('removed scripts');}\nlogger.debug('deleting cb');win['cb'+jsonpId]=undefined;logger.debug('deleting eb');win['eb'+jsonpId]=undefined;if(!errorSuppressed&&self.opened){logger.debug('calling errback');eb.apply(null,arguments);}}\nwin['cb'+jsonpId]=function callback(){logger.debug('successful: ',fullUrl,[].slice.call(arguments,0));errorSuppressed=true;logger.debug('calling the cb');cb.apply(null,arguments);logger.debug('cb called');}\nvar fullUrl=url+'?'\nfor(key in args){fullUrl+=key+'='+args[key]+'&';}\nif(rType==\"send\"){fullUrl+='rs=;&rp=cb'+jsonpId;}\nelse if(rType==\"comet\"){fullUrl+='bs=;&bp=cb'+jsonpId;}\nvar s=doc.createElement(\"script\");s.src=fullUrl;if(s.src.toString().indexOf('\"')!=-1){s.src=s.src.toString().replace(/\\\"/g,\"%22\");}\nhead.appendChild(s);if(s.onreadystatechange===null){s.onreadystatechange=function(){if(s.readyState==\"loaded\"){errback(true);}}}\nelse{var s=doc.createElement(\"script\");s.innerHTML='eb'+jsonpId+'(false);'\nhead.appendChild(s);killLoadingBar();}}),0);}\nfunction killLoadingBar(){}}));"},'jsio.interfaces':{"url":"jsio/interfaces.js","src":"\njsio('import Class, bind');exports.Protocol=Class(function(){this.connectionMade=function(isReconnect){}\nthis.dataReceived=function(data){}\nthis.connectionLost=function(reason){}\nthis.connectionFailed=function(){}});exports.Server=Class(function(){this.init=function(protocolClass){this._protocolClass=protocolClass;}\nthis.buildProtocol=function(){return new this._protocolClass();}});exports.Transport=Class(function(){this.write=function(data,encoding){throw new Error(\"Not implemented\");}\nthis.getPeer=function(){throw new Error(\"Not implemented\");}});exports.Listener=Class(function(){this.init=function(server,opts){this._server=server;this._opts=opts||{};}\nthis.onConnect=function(transport){var p=this._server.buildProtocol();p.transport=transport;p.server=this._server;transport.protocol=p;transport.makeConnection(p);p.connectionMade();}\nthis.listen=function(){throw new Error('Abstract class');}\nthis.stop=function(){}});exports.Connector=Class(function(){this.init=function(protocol,opts){this._protocol=protocol;this._opts=opts;}\nthis.onConnect=function(transport){transport.makeConnection(this._protocol);this._protocol.transport=transport;this._protocol.connectionMade();}\nthis.getProtocol=function(){return this._protocol;}});exports.PubSub=Class(function(){this.publish=function(signal){if(!this._subscribers){return;}\nvar args=Array.prototype.slice.call(arguments,1);if(this._subscribers.__any){var anyArgs=[signal].concat(args);for(var i=0,sub;sub=this._subscribers.__any[i];++i){sub.apply(window,args);}}\nif(!this._subscribers[signal]){return;}\nfor(var i=0,sub;sub=this._subscribers[signal][i];++i){sub.apply(window,args);}}\nthis.subscribe=function(signal){if(!this._subscribers){this._subscribers={};}\nif(!this._subscribers[signal]){this._subscribers[signal]=[];}\nthis._subscribers[signal].push(bind.apply(jsio,Array.prototype.slice.call(arguments,1)));}});"},'jsio.csp.client':{"url":"jsio/csp/client.js","src":"\njsio('import jsio.std.base64 as base64');jsio('import jsio.std.utf8 as utf8');jsio('import jsio.std.uri as uri');jsio('import logging');jsio('import .errors');jsio('import .transports');var logger=logging.getLogger(\"csp.client\");var READYSTATE=exports.READYSTATE={INITIAL:0,CONNECTING:1,CONNECTED:2,DISCONNECTING:3,DISCONNECTED:4};exports.CometSession=Class(function(supr){var id=0;var kDefaultBackoff=50;var kDefaultTimeoutInterval=45000;var kDefaultHandshakeTimeout=10000;this.init=function(){this._id=++id;this._url=null;this.readyState=READYSTATE.INITIAL;this._sessionKey=null;this._transport=null;this._options=null;this._utf8ReadBuffer=\"\";this._writeBuffer=\"\";this._packetsInFlight=null;this._lastEventId=null;this._lastSentId=null;this._handshakeLater=null;this._handshakeBackoff=kDefaultBackoff;this._handshakeRetryTimer=null;this._handshakeTimeoutTimer=null;this._timeoutTimer=null;this._writeBackoff=kDefaultBackoff;this._writeRetryTimer=null;this.cometBackoff=kDefaultBackoff;this._cometRetryTimer=null;}\nthis.setEncoding=function(encoding){if(encoding==this._options.encoding){return;}\nif(encoding!='utf8'&&encoding!='plain'){throw new errors.InvalidEncodingError();}\nif(encoding=='plain'&&this._buffer){var buffer=this._utf8ReadBuffer;this._utf8ReadBuffer=\"\";this._doOnRead(buffer);}\nthis._options.encoding=encoding;}\nthis.connect=function(url,options){this._url=url;this._options=options||{};this._options.encoding=this._options.encoding||'utf8';this.setEncoding(this._options.encoding);this._options.connectTimeout=this._options.connectTimeout||kDefaultHandshakeTimeout;var transportClass=transports.chooseTransport(url,this._options);this._transport=new transportClass();this._transport.handshakeFailure=bind(this,this._handshakeFailure);this._transport.handshakeSuccess=bind(this,this._handshakeSuccess);this._transport.cometFailure=bind(this,this._cometFailure);this._transport.cometSuccess=bind(this,this._cometSuccess);this._transport.sendFailure=bind(this,this._writeFailure);this._transport.sendSuccess=bind(this,this._writeSuccess);this.readyState=READYSTATE.CONNECTING;this._transport.handshake(this._url,this._options);this._handshakeTimeoutTimer=setTimeout(bind(this,this._handshakeTimeout),this._options.connectTimeout);}\nthis.write=function(data,encoding){if(this.readyState!=READYSTATE.CONNECTED){throw new errors.ReadyStateError();}\nencoding=encoding||this._options.encoding||'utf8';if(encoding=='utf8'){data=utf8.encode(data);}\nthis._writeBuffer+=data;this._doWrite();}\nthis.close=function(err){switch(this.readyState){case READYSTATE.CONNECTING:clearTimeout(this._handshakeRetryTimer);clearTimeout(this._handshakeTimeoutTimer);break;case READYSTATE.CONNECTED:this._transport.abort();clearTimeout(this._cometRetryTimer);clearTimeout(this._writeRetryTimer);clearTimeout(this._timeoutTimer);break;case READYSTATE.DISCONNECTED:throw new errors.ReadyStateError(\"Session is already disconnected\");break;}\nthis._doOnDisconnect(err);}\nthis._handshakeTimeout=function(){logger.debug('handshake timeout');this._handshakeTimeoutTimer=null;this._doOnDisconnect(new errors.HandshakeTimeout());}\nthis._handshakeSuccess=function(d){logger.debug('handshake success',d);if(this.readyState!=READYSTATE.CONNECTING){logger.debug('received handshake success in invalid readyState:',this.readyState);return;}\nclearTimeout(this._handshakeTimeoutTimer);this._handshakeTimeoutTimer=null;this._sessionKey=d.session;this._opened=true;this.readyState=READYSTATE.CONNECTED;this._doOnConnect();this._doConnectComet();}\nthis._handshakeFailure=function(e){logger.debug('handshake failure',e);if(this.readyState!=READYSTATE.CONNECTING){return;}\nthis._handshakeRetryTimer=setTimeout(bind(this,function(){this._handshakeRetryTimer=null;this._transport.handshake(this._url,this._options);}),this._handshakeBackoff);this._handshakeBackoff*=2;}\nthis._writeSuccess=function(){if(this.readyState!=READYSTATE.CONNECTED){return;}\nthis._resetTimeoutTimer();this.writeBackoff=kDefaultBackoff;this._packetsInFlight=null;if(this._writeBuffer){this._doWrite();}}\nthis._writeFailure=function(){if(this.readyState!=READYSTATE.CONNECTED){return;}\nthis._writeTimer=setTimeout(bind(this,function(){this._writeTimer=null;this._doWrite();}),this._writeBackoff);this._writeBackoff*=2;}\nthis._doWrite=function(){logger.debug('_writeBuffer:',this._writeBuffer);var newPacket=this._transport.encodePacket(++this._lastSentId,this._writeBuffer,this._options);this._writeBuffer=\"\";logger.debug('newPacket:',newPacket);if(!this._packetsInFlight){this._packetsInFlight=[newPacket];}\nlogger.debug('json packets:',JSON.stringify(this._packetsInFlight));this._transport.send(this._url,this._sessionKey,JSON.stringify(this._packetsInFlight),this._options);}\nthis._doConnectComet=function(){logger.debug('_doConnectComet');this._transport.comet(this._url,this._sessionKey,this._lastEventId||0,this._options);}\nthis._cometFailure=function(){if(this.readyState!=READYSTATE.CONNECTED){return;}\nthis._cometTimer=setTimeout(bind(this,function(){this._doConnectComet();}),this._cometBackoff);this._cometBackoff*=2;}\nthis._cometSuccess=function(packets){if(this.readyState!=READYSTATE.CONNECTED){return;}\nlogger.debug('comet Success:',packets);this._cometBackoff=kDefaultBackoff;this._resetTimeoutTimer();for(var i=0,packet;(packet=packets[i])||i<packets.length;i++){logger.debug('process packet:',packet);if(packet===null){return self._doClose();}\nlogger.debug('process packet',packet);var ackId=packet[0];var encoding=packet[1];var data=packet[2];if(typeof(this._lastEventId)=='number'&&ackId<=this._lastEventId){continue;}\nif(typeof(this._lastEventId)=='number'&&ackId!=this._lastEventId+1){return this._doClose(new errors.ServerProtocolError(201));}\nthis._lastEventId=ackId;if(encoding==1){try{logger.debug('before base64 decode:',data);data=base64.decode(data);logger.debug('after base64 decode:',data);}catch(e){return this._doClose(new errors.ServerProtocolError(202));}}\nif(this._options.encoding=='utf8'){this._utf8ReadBuffer+=data;logger.debug('before utf8 decode, _utf8ReadBuffer:',this._utf8ReadBuffer);var result=utf8.decode(this._utf8ReadBuffer);data=result[0];this._utf8ReadBuffer=this._utf8ReadBuffer.slice(result[1]);logger.debug('after utf8 decode, _utf8ReadBuffer:',this._utf8ReadBuffer,'data:',data);}\nlogger.debug('dispatching data:',data);try{this._doOnRead(data);}catch(e){logger.error('application code threw an error. (re-throwing in timeout):',e);setTimeout(function(){logger.debug('timeout fired, throwing error',e);throw e;},0);}}\nthis._doConnectComet();}\nthis._doOnRead=function(data){if(typeof(this.onread)=='function'){logger.debug('call onread function',data);this.onread(data);}\nelse{logger.debug('skipping onread callback (function missing)');}}\nthis._doOnDisconnect=function(err){if(typeof(this.ondisconnect)=='function'){logger.debug('call ondisconnect function',data);this.ondisconnect(err);}\nelse{logger.debug('skipping ondisconnect callback (function missing)');}}\nthis._doOnConnect=function(){if(typeof(this.onconnect)=='function'){logger.debug('call onconnect function');try{this.onconnect();}catch(e){logger.debug('onconnect caused errror',e);setTimeout(function(){throw e},0);}}\nelse{logger.debug('skipping onconnect callback (function missing)');}}\nthis._resetTimeoutTimer=function(){clearTimeout(this._timeoutTimer);this._timeoutTimer=setTimeout(bind(this,function(){logger.debug('connection timeout expired');this.close(new errors.SessionTimeout())}),this._getTimeoutInterval())}\nthis._getTimeoutInterval=function(){return kDefaultTimeoutInterval;}})"},'world.client':{"url":"world/client.js","src":"\njsio('import .client.player, .client.protocol');exports={WorldPlayer:client.player.WorldPlayer,WorldProtocol:client.protocol.WorldProtocol};"},'world.client.protocol':{"url":"world/client/protocol.js","src":"\njsio('import Class, bind');jsio('import logging');jsio('from jsio.interfaces import PubSub');jsio('from jsio.protocols.rtjp import RTJPProtocol');var logger=logging.getLogger('world.client');logger.setLevel(0);exports.WorldProtocol=Class([RTJPProtocol,PubSub],function(supr){this.init=function(playerFactory,username,avatarUrl){supr(this,'init');this.playerFactory=playerFactory;this.username=username;this.avatarUrl=avatarUrl;this.players={};this.onJoin({username:this.username,url:avatarUrl});this.self=this.players[this.username];this._update=bind(this,'update');}\nthis.update=function(){var again=false;for(var username in this.players){again|=this.players[username].update();}\nthis.interval=again?setTimeout(this._update,25):null;}\nthis.onWelcome=function(presence,history){for(var i=0,p;p=presence[i];++i){this.onJoin(p);}\nif(!this.interval){this.update();}}\nthis.onMove=function(username,x,y){this.players[username].move(x,y);if(!this.interval){this.update();}}\nthis.onSay=function(params){this.players[params.username].say(params.msg,params.ts);this.publish('say',params,this.players[params.username].color);}\nthis.onJoin=function(params){if(!(params.username in this.players)){this.players[params.username]=this.playerFactory(params);if(!this.interval){this.update();}}}\nthis.onLeave=function(username){this.players[username].destroy();delete this.players[username];}\nthis.onError=function(msg){}\nthis.move=function(x,y){this.self.move(x,y);if(!this.interval){this.update();}\ntry{this.sendFrame('MOVE',{x:x,y:y});}catch(e){}}\nthis.say=function(msg){this.self.say(msg);this.publish('say',{username:this.username,msg:msg,ts:+new Date(),color:this.self.color})\ntry{this.sendFrame('SAY',{msg:msg});}catch(e){}}\nthis.frameReceived=function(id,name,args){logger.debug('frameReceived',id,name,args);switch(name){case'WELCOME':this.onWelcome(args.presence,args.history);this.publish('welcome',args.presence,args.history);break;case'SAY':this.onSay(args);break;case'MOVE':this.onMove(args.username,args.x,args.y);break;case'JOIN':this.onJoin(args);break;case'LEAVE':this.onLeave(args.username);break;case'ERROR':this.onError(args.msg);break;default:break;}}\nthis.connectionMade=function(){this.sendFrame('LOGIN',{username:this.username,url:this.avatarUrl,x:this.self.x,y:this.self.y,color:this.self.color});}\nthis.connectionLost=function(){alert('oops, the connection was lost');window.location.replace();}});"},'jsio.util.sizzle':{"url":"jsio/util/sizzle.js","src":"\n(function(){var chunker=/((?:\\((?:\\([^()]+\\)|[^()]+)+\\)|\\[(?:\\[[^[\\]]*\\]|['\"][^'\"]*['\"]|[^[\\]'\"]+)+\\]|\\\\.|[^ >+~,(\\[\\\\]+)+|[>+~])(\\s*,\\s*)?/g,done=0,toString=Object.prototype.toString,hasDuplicate=false;var Sizzle=function(selector,context,results,seed){results=results||[];var origContext=context=context||document;if(context.nodeType!==1&&context.nodeType!==9){return[];}\nif(!selector||typeof selector!==\"string\"){return results;}\nvar parts=[],m,set,checkSet,check,mode,extra,prune=true,contextXML=isXML(context);chunker.lastIndex=0;while((m=chunker.exec(selector))!==null){parts.push(m[1]);if(m[2]){extra=RegExp.rightContext;break;}}\nif(parts.length>1&&origPOS.exec(selector)){if(parts.length===2&&Expr.relative[parts[0]]){set=posProcess(parts[0]+parts[1],context);}else{set=Expr.relative[parts[0]]?[context]:Sizzle(parts.shift(),context);while(parts.length){selector=parts.shift();if(Expr.relative[selector])\nselector+=parts.shift();set=posProcess(selector,set);}}}else{if(!seed&&parts.length>1&&context.nodeType===9&&!contextXML&&Expr.match.ID.test(parts[0])&&!Expr.match.ID.test(parts[parts.length-1])){var ret=Sizzle.find(parts.shift(),context,contextXML);context=ret.expr?Sizzle.filter(ret.expr,ret.set)[0]:ret.set[0];}\nif(context){var ret=seed?{expr:parts.pop(),set:makeArray(seed)}:Sizzle.find(parts.pop(),parts.length===1&&(parts[0]===\"~\"||parts[0]===\"+\")&&context.parentNode?context.parentNode:context,contextXML);set=ret.expr?Sizzle.filter(ret.expr,ret.set):ret.set;if(parts.length>0){checkSet=makeArray(set);}else{prune=false;}\nwhile(parts.length){var cur=parts.pop(),pop=cur;if(!Expr.relative[cur]){cur=\"\";}else{pop=parts.pop();}\nif(pop==null){pop=context;}\nExpr.relative[cur](checkSet,pop,contextXML);}}else{checkSet=parts=[];}}\nif(!checkSet){checkSet=set;}\nif(!checkSet){throw\"Syntax error, unrecognized expression: \"+(cur||selector);}\nif(toString.call(checkSet)===\"[object Array]\"){if(!prune){results.push.apply(results,checkSet);}else if(context&&context.nodeType===1){for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&(checkSet[i]===true||checkSet[i].nodeType===1&&contains(context,checkSet[i]))){results.push(set[i]);}}}else{for(var i=0;checkSet[i]!=null;i++){if(checkSet[i]&&checkSet[i].nodeType===1){results.push(set[i]);}}}}else{makeArray(checkSet,results);}\nif(extra){Sizzle(extra,origContext,results,seed);Sizzle.uniqueSort(results);}\nreturn results;};Sizzle.uniqueSort=function(results){if(sortOrder){hasDuplicate=false;results.sort(sortOrder);if(hasDuplicate){for(var i=1;i<results.length;i++){if(results[i]===results[i-1]){results.splice(i--,1);}}}}};Sizzle.matches=function(expr,set){return Sizzle(expr,null,null,set);};Sizzle.find=function(expr,context,isXML){var set,match;if(!expr){return[];}\nfor(var i=0,l=Expr.order.length;i<l;i++){var type=Expr.order[i],match;if((match=Expr.match[type].exec(expr))){var left=RegExp.leftContext;if(left.substr(left.length-1)!==\"\\\\\"){match[1]=(match[1]||\"\").replace(/\\\\/g,\"\");set=Expr.find[type](match,context,isXML);if(set!=null){expr=expr.replace(Expr.match[type],\"\");break;}}}}\nif(!set){set=context.getElementsByTagName(\"*\");}\nreturn{set:set,expr:expr};};Sizzle.filter=function(expr,set,inplace,not){var old=expr,result=[],curLoop=set,match,anyFound,isXMLFilter=set&&set[0]&&isXML(set[0]);while(expr&&set.length){for(var type in Expr.filter){if((match=Expr.match[type].exec(expr))!=null){var filter=Expr.filter[type],found,item;anyFound=false;if(curLoop==result){result=[];}\nif(Expr.preFilter[type]){match=Expr.preFilter[type](match,curLoop,inplace,result,not,isXMLFilter);if(!match){anyFound=found=true;}else if(match===true){continue;}}\nif(match){for(var i=0;(item=curLoop[i])!=null;i++){if(item){found=filter(item,match,i,curLoop);var pass=not^!!found;if(inplace&&found!=null){if(pass){anyFound=true;}else{curLoop[i]=false;}}else if(pass){result.push(item);anyFound=true;}}}}\nif(found!==undefined){if(!inplace){curLoop=result;}\nexpr=expr.replace(Expr.match[type],\"\");if(!anyFound){return[];}\nbreak;}}}\nif(expr==old){if(anyFound==null){throw\"Syntax error, unrecognized expression: \"+expr;}else{break;}}\nold=expr;}\nreturn curLoop;};var Expr=Sizzle.selectors={order:[\"ID\",\"NAME\",\"TAG\"],match:{ID:/#((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,CLASS:/\\.((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)/,NAME:/\\[name=['\"]*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)['\"]*\\]/,ATTR:/\\[\\s*((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)\\s*(?:(\\S?=)\\s*(['\"]*)(.*?)\\3|)\\s*\\]/,TAG:/^((?:[\\w\\u00c0-\\uFFFF\\*_-]|\\\\.)+)/,CHILD:/:(only|nth|last|first)-child(?:\\((even|odd|[\\dn+-]*)\\))?/,POS:/:(nth|eq|gt|lt|first|last|even|odd)(?:\\((\\d*)\\))?(?=[^-]|$)/,PSEUDO:/:((?:[\\w\\u00c0-\\uFFFF_-]|\\\\.)+)(?:\\((['\"]*)((?:\\([^\\)]+\\)|[^\\2\\(\\)]*)+)\\2\\))?/},attrMap:{\"class\":\"className\",\"for\":\"htmlFor\"},attrHandle:{href:function(elem){return elem.getAttribute(\"href\");}},relative:{\"+\":function(checkSet,part,isXML){var isPartStr=typeof part===\"string\",isTag=isPartStr&&!/\\W/.test(part),isPartStrNotTag=isPartStr&&!isTag;if(isTag&&!isXML){part=part.toUpperCase();}\nfor(var i=0,l=checkSet.length,elem;i<l;i++){if((elem=checkSet[i])){while((elem=elem.previousSibling)&&elem.nodeType!==1){}\ncheckSet[i]=isPartStrNotTag||elem&&elem.nodeName===part?elem||false:elem===part;}}\nif(isPartStrNotTag){Sizzle.filter(part,checkSet,true);}},\">\":function(checkSet,part,isXML){var isPartStr=typeof part===\"string\";if(isPartStr&&!/\\W/.test(part)){part=isXML?part:part.toUpperCase();for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){var parent=elem.parentNode;checkSet[i]=parent.nodeName===part?parent:false;}}}else{for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){checkSet[i]=isPartStr?elem.parentNode:elem.parentNode===part;}}\nif(isPartStr){Sizzle.filter(part,checkSet,true);}}},\"\":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(!/\\W/.test(part)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck;}\ncheckFn(\"parentNode\",part,doneName,checkSet,nodeCheck,isXML);},\"~\":function(checkSet,part,isXML){var doneName=done++,checkFn=dirCheck;if(typeof part===\"string\"&&!/\\W/.test(part)){var nodeCheck=part=isXML?part:part.toUpperCase();checkFn=dirNodeCheck;}\ncheckFn(\"previousSibling\",part,doneName,checkSet,nodeCheck,isXML);}},find:{ID:function(match,context,isXML){if(typeof context.getElementById!==\"undefined\"&&!isXML){var m=context.getElementById(match[1]);return m?[m]:[];}},NAME:function(match,context,isXML){if(typeof context.getElementsByName!==\"undefined\"){var ret=[],results=context.getElementsByName(match[1]);for(var i=0,l=results.length;i<l;i++){if(results[i].getAttribute(\"name\")===match[1]){ret.push(results[i]);}}\nreturn ret.length===0?null:ret;}},TAG:function(match,context){return context.getElementsByTagName(match[1]);}},preFilter:{CLASS:function(match,curLoop,inplace,result,not,isXML){match=\" \"+match[1].replace(/\\\\/g,\"\")+\" \";if(isXML){return match;}\nfor(var i=0,elem;(elem=curLoop[i])!=null;i++){if(elem){if(not^(elem.className&&(\" \"+elem.className+\" \").indexOf(match)>=0)){if(!inplace)\nresult.push(elem);}else if(inplace){curLoop[i]=false;}}}\nreturn false;},ID:function(match){return match[1].replace(/\\\\/g,\"\");},TAG:function(match,curLoop){for(var i=0;curLoop[i]===false;i++){}\nreturn curLoop[i]&&isXML(curLoop[i])?match[1]:match[1].toUpperCase();},CHILD:function(match){if(match[1]==\"nth\"){var test=/(-?)(\\d*)n((?:\\+|-)?\\d*)/.exec(match[2]==\"even\"&&\"2n\"||match[2]==\"odd\"&&\"2n+1\"||!/\\D/.test(match[2])&&\"0n+\"+match[2]||match[2]);match[2]=(test[1]+(test[2]||1))-0;match[3]=test[3]-0;}\nmatch[0]=done++;return match;},ATTR:function(match,curLoop,inplace,result,not,isXML){var name=match[1].replace(/\\\\/g,\"\");if(!isXML&&Expr.attrMap[name]){match[1]=Expr.attrMap[name];}\nif(match[2]===\"~=\"){match[4]=\" \"+match[4]+\" \";}\nreturn match;},PSEUDO:function(match,curLoop,inplace,result,not){if(match[1]===\"not\"){if(chunker.exec(match[3]).length>1||/^\\w/.test(match[3])){match[3]=Sizzle(match[3],null,null,curLoop);}else{var ret=Sizzle.filter(match[3],curLoop,inplace,true^not);if(!inplace){result.push.apply(result,ret);}\nreturn false;}}else if(Expr.match.POS.test(match[0])||Expr.match.CHILD.test(match[0])){return true;}\nreturn match;},POS:function(match){match.unshift(true);return match;}},filters:{enabled:function(elem){return elem.disabled===false&&elem.type!==\"hidden\";},disabled:function(elem){return elem.disabled===true;},checked:function(elem){return elem.checked===true;},selected:function(elem){elem.parentNode.selectedIndex;return elem.selected===true;},parent:function(elem){return!!elem.firstChild;},empty:function(elem){return!elem.firstChild;},has:function(elem,i,match){return!!Sizzle(match[3],elem).length;},header:function(elem){return/h\\d/i.test(elem.nodeName);},text:function(elem){return\"text\"===elem.type;},radio:function(elem){return\"radio\"===elem.type;},checkbox:function(elem){return\"checkbox\"===elem.type;},file:function(elem){return\"file\"===elem.type;},password:function(elem){return\"password\"===elem.type;},submit:function(elem){return\"submit\"===elem.type;},image:function(elem){return\"image\"===elem.type;},reset:function(elem){return\"reset\"===elem.type;},button:function(elem){return\"button\"===elem.type||elem.nodeName.toUpperCase()===\"BUTTON\";},input:function(elem){return/input|select|textarea|button/i.test(elem.nodeName);}},setFilters:{first:function(elem,i){return i===0;},last:function(elem,i,match,array){return i===array.length-1;},even:function(elem,i){return i%2===0;},odd:function(elem,i){return i%2===1;},lt:function(elem,i,match){return i<match[3]-0;},gt:function(elem,i,match){return i>match[3]-0;},nth:function(elem,i,match){return match[3]-0==i;},eq:function(elem,i,match){return match[3]-0==i;}},filter:{PSEUDO:function(elem,match,i,array){var name=match[1],filter=Expr.filters[name];if(filter){return filter(elem,i,match,array);}else if(name===\"contains\"){return(elem.textContent||elem.innerText||\"\").indexOf(match[3])>=0;}else if(name===\"not\"){var not=match[3];for(var i=0,l=not.length;i<l;i++){if(not[i]===elem){return false;}}\nreturn true;}},CHILD:function(elem,match){var type=match[1],node=elem;switch(type){case'only':case'first':while((node=node.previousSibling)){if(node.nodeType===1)return false;}\nif(type=='first')return true;node=elem;case'last':while((node=node.nextSibling)){if(node.nodeType===1)return false;}\nreturn true;case'nth':var first=match[2],last=match[3];if(first==1&&last==0){return true;}\nvar doneName=match[0],parent=elem.parentNode;if(parent&&(parent.sizcache!==doneName||!elem.nodeIndex)){var count=0;for(node=parent.firstChild;node;node=node.nextSibling){if(node.nodeType===1){node.nodeIndex=++count;}}\nparent.sizcache=doneName;}\nvar diff=elem.nodeIndex-last;if(first==0){return diff==0;}else{return(diff%first==0&&diff/first>=0);}}},ID:function(elem,match){return elem.nodeType===1&&elem.getAttribute(\"id\")===match;},TAG:function(elem,match){return(match===\"*\"&&elem.nodeType===1)||elem.nodeName===match;},CLASS:function(elem,match){return(\" \"+(elem.className||elem.getAttribute(\"class\"))+\" \").indexOf(match)>-1;},ATTR:function(elem,match){var name=match[1],result=Expr.attrHandle[name]?Expr.attrHandle[name](elem):elem[name]!=null?elem[name]:elem.getAttribute(name),value=result+\"\",type=match[2],check=match[4];return result==null?type===\"!=\":type===\"=\"?value===check:type===\"*=\"?value.indexOf(check)>=0:type===\"~=\"?(\" \"+value+\" \").indexOf(check)>=0:!check?value&&result!==false:type===\"!=\"?value!=check:type===\"^=\"?value.indexOf(check)===0:type===\"$=\"?value.substr(value.length-check.length)===check:type===\"|=\"?value===check||value.substr(0,check.length+1)===check+\"-\":false;},POS:function(elem,match,i,array){var name=match[2],filter=Expr.setFilters[name];if(filter){return filter(elem,i,match,array);}}}};var origPOS=Expr.match.POS;for(var type in Expr.match){Expr.match[type]=new RegExp(Expr.match[type].source+/(?![^\\[]*\\])(?![^\\(]*\\))/.source);}\nvar makeArray=function(array,results){array=Array.prototype.slice.call(array,0);if(results){results.push.apply(results,array);return results;}\nreturn array;};try{Array.prototype.slice.call(document.documentElement.childNodes,0);}catch(e){makeArray=function(array,results){var ret=results||[];if(toString.call(array)===\"[object Array]\"){Array.prototype.push.apply(ret,array);}else{if(typeof array.length===\"number\"){for(var i=0,l=array.length;i<l;i++){ret.push(array[i]);}}else{for(var i=0;array[i];i++){ret.push(array[i]);}}}\nreturn ret;};}\nvar sortOrder;if(document.documentElement.compareDocumentPosition){sortOrder=function(a,b){var ret=a.compareDocumentPosition(b)&4?-1:a===b?0:1;if(ret===0){hasDuplicate=true;}\nreturn ret;};}else if(\"sourceIndex\"in document.documentElement){sortOrder=function(a,b){var ret=a.sourceIndex-b.sourceIndex;if(ret===0){hasDuplicate=true;}\nreturn ret;};}else if(document.createRange){sortOrder=function(a,b){var aRange=a.ownerDocument.createRange(),bRange=b.ownerDocument.createRange();aRange.selectNode(a);aRange.collapse(true);bRange.selectNode(b);bRange.collapse(true);var ret=aRange.compareBoundaryPoints(Range.START_TO_END,bRange);if(ret===0){hasDuplicate=true;}\nreturn ret;};}\n(function(){var form=document.createElement(\"div\"),id=\"script\"+(new Date).getTime();form.innerHTML=\"<a name='\"+id+\"'/>\";var root=document.documentElement;root.insertBefore(form,root.firstChild);if(!!document.getElementById(id)){Expr.find.ID=function(match,context,isXML){if(typeof context.getElementById!==\"undefined\"&&!isXML){var m=context.getElementById(match[1]);return m?m.id===match[1]||typeof m.getAttributeNode!==\"undefined\"&&m.getAttributeNode(\"id\").nodeValue===match[1]?[m]:undefined:[];}};Expr.filter.ID=function(elem,match){var node=typeof elem.getAttributeNode!==\"undefined\"&&elem.getAttributeNode(\"id\");return elem.nodeType===1&&node&&node.nodeValue===match;};}\nroot.removeChild(form);root=form=null;})();(function(){var div=document.createElement(\"div\");div.appendChild(document.createComment(\"\"));if(div.getElementsByTagName(\"*\").length>0){Expr.find.TAG=function(match,context){var results=context.getElementsByTagName(match[1]);if(match[1]===\"*\"){var tmp=[];for(var i=0;results[i];i++){if(results[i].nodeType===1){tmp.push(results[i]);}}\nresults=tmp;}\nreturn results;};}\ndiv.innerHTML=\"<a href='#'></a>\";if(div.firstChild&&typeof div.firstChild.getAttribute!==\"undefined\"&&div.firstChild.getAttribute(\"href\")!==\"#\"){Expr.attrHandle.href=function(elem){return elem.getAttribute(\"href\",2);};}\ndiv=null;})();if(document.querySelectorAll)(function(){var oldSizzle=Sizzle,div=document.createElement(\"div\");div.innerHTML=\"<p class='TEST'></p>\";if(div.querySelectorAll&&div.querySelectorAll(\".TEST\").length===0){return;}\nSizzle=function(query,context,extra,seed){context=context||document;if(!seed&&context.nodeType===9&&!isXML(context)){try{return makeArray(context.querySelectorAll(query),extra);}catch(e){}}\nreturn oldSizzle(query,context,extra,seed);};for(var prop in oldSizzle){Sizzle[prop]=oldSizzle[prop];}\ndiv=null;})();if(document.getElementsByClassName&&document.documentElement.getElementsByClassName)(function(){var div=document.createElement(\"div\");div.innerHTML=\"<div class='test e'></div><div class='test'></div>\";if(div.getElementsByClassName(\"e\").length===0)\nreturn;div.lastChild.className=\"e\";if(div.getElementsByClassName(\"e\").length===1)\nreturn;Expr.order.splice(1,0,\"CLASS\");Expr.find.CLASS=function(match,context,isXML){if(typeof context.getElementsByClassName!==\"undefined\"&&!isXML){return context.getElementsByClassName(match[1]);}};div=null;})();function dirNodeCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir==\"previousSibling\"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i;}\nelem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break;}\nif(elem.nodeType===1&&!isXML){elem.sizcache=doneName;elem.sizset=i;}\nif(elem.nodeName===cur){match=elem;break;}\nelem=elem[dir];}\ncheckSet[i]=match;}}}\nfunction dirCheck(dir,cur,doneName,checkSet,nodeCheck,isXML){var sibDir=dir==\"previousSibling\"&&!isXML;for(var i=0,l=checkSet.length;i<l;i++){var elem=checkSet[i];if(elem){if(sibDir&&elem.nodeType===1){elem.sizcache=doneName;elem.sizset=i;}\nelem=elem[dir];var match=false;while(elem){if(elem.sizcache===doneName){match=checkSet[elem.sizset];break;}\nif(elem.nodeType===1){if(!isXML){elem.sizcache=doneName;elem.sizset=i;}\nif(typeof cur!==\"string\"){if(elem===cur){match=true;break;}}else if(Sizzle.filter(cur,[elem]).length>0){match=elem;break;}}\nelem=elem[dir];}\ncheckSet[i]=match;}}}\nvar contains=document.compareDocumentPosition?function(a,b){return a.compareDocumentPosition(b)&16;}:function(a,b){return a!==b&&(a.contains?a.contains(b):true);};var isXML=function(elem){return elem.nodeType===9&&elem.documentElement.nodeName!==\"HTML\"||!!elem.ownerDocument&&elem.ownerDocument.documentElement.nodeName!==\"HTML\";};var posProcess=function(selector,context){var tmpSet=[],later=\"\",match,root=context.nodeType?[context]:context;while((match=Expr.match.PSEUDO.exec(selector))){later+=match[0];selector=selector.replace(Expr.match.PSEUDO,\"\");}\nselector=Expr.relative[selector]?selector+\"*\":selector;for(var i=0,l=root.length;i<l;i++){Sizzle(selector,root[i],tmpSet);}\nreturn Sizzle.filter(later,tmpSet);};window.Sizzle=Sizzle;})();"},'world.constants':{"url":"world/constants.js","src":"\nexports={kBounds:{minX:0,maxX:640,minY:0,maxY:480},kGameWidth:640,kGameHeight:480,kPlayerSize:25,kSprite:{up:[165,-5],down:[223,-5],left:[104,-5],right:[283,-38]}};"},'world.client.player':{"url":"world/client/player.js","src":"\njsio('import Class, bind');jsio('from jsio.interfaces import PubSub');jsio('from ..constants import *');exports.WorldPlayer=Class(PubSub,function(){this.init=function(params){if(!params){params={};}\nthis.historyEl=params.history;this.username=params.username||'';this.color=params.color||{r:Math.floor(Math.random()*128)+128,g:Math.floor(Math.random()*128)+128,b:Math.floor(Math.random()*128)+128};this._x=this.x=params.x||Math.floor(Math.random()*(kGameWidth-20))+10;this._y=this.y=params.y||Math.floor(Math.random()*(kGameHeight-20))+10;this.dir='down';this.el=$.create({className:'player',style:{width:kPlayerSize+'px',height:kPlayerSize+'px'},parent:params.parent});this.text=$.create({className:'msg',parent:params.parent,text:params.msg||'',style:{color:'rgb('+this.color.r+','+this.color.g+','+this.color.b+')'}});this.name=$.create({className:'name',parent:params.parent,text:this.username.substring(0,14)});}\nthis.say=function(text,ts){if(!text){text='';}\nif(text.length>140){text=text.substring(0,140)+'\\u2026';}\n$.setText(this.text,text);}\nthis.move=function(x,y){if(x<kBounds.minX)x=kBounds.minX;if(x>kBounds.maxX)x=kBounds.maxX;if(y<kBounds.minY)y=kBounds.minY;if(y>kBounds.maxY)y=kBounds.maxY;this.x=x;this.y=y;if(this._y===null){this._x=x;this._y=y;}\nthis.update();}\nthis.update=function(){if(this._x!=this.x||this._y!=this.y){var dx=this.x-this._x;var dy=this.y-this._y;var adx=Math.abs(dx);var ady=Math.abs(dy);if(adx>ady){this.dir=dx>0?'right':'left';}else{this.dir=dy>=0?'down':'up';}\nif(dx*dx+dy*dy<1){this._x=this.x;this._y=this.y;}else if(adx>ady){this._x+=this._x<this.x?1:-1;this._y+=this._y<this.y?ady/adx:-ady/adx;}else{this._y+=this._y<this.y?1:-1;this._x+=this._x<this.x?adx/ady:-adx/ady;}}\n$.style(this.el,{top:this._y+'px',left:this._x+'px',backgroundPosition:kSprite[this.dir][0]+'px '+kSprite[this.dir][1]+'px'});$.style(this.text,{top:this._y-15+'px',left:this._x+25+'px'});$.style(this.name,{top:this._y+20+'px',left:this._x+'px'});return this._x!=this.x||this._y!=this.y;}\nthis.destroy=function(){$.remove(this.el);$.remove(this.name);$.remove(this.text);}});"},'jsio.env.browser.csp':{"url":"jsio/env/browser/csp.js","src":"\njsio('import Class, bind, logging, jsio.interfaces');jsio('from jsio.csp.client import CometSession');var logger=logging.getLogger('env.browser.csp');exports.Connector=Class(jsio.interfaces.Connector,function(){this.connect=function(){var conn=new CometSession();conn.onconnect=bind(this,function(){logger.debug('conn has opened');this.onConnect(new Transport(conn));});conn.ondisconnect=bind(this,function(code){logger.debug('conn closed without opening, code:',code);});logger.debug('open the conection');conn.connect(this._opts.url,{encoding:'plain'});}});var Transport=Class(jsio.interfaces.Transport,function(){this.init=function(conn){this._conn=conn;}\nthis.makeConnection=function(protocol){this._conn.onread=bind(protocol,'dataReceived');this._conn.ondisconnect=bind(protocol,'connectionLost');}\nthis.write=function(data,encoding){this._conn.write(data);}\nthis.loseConnection=function(protocol){this._conn.close();}});"},'jsio.util.browser':{"url":"jsio/util/browser.js","src":"\njsio('external .sizzle import Sizzle');var $=exports.$=Sizzle;$.id=function(id,win){return typeof id=='string'?(win||window).document.getElementById(id):id;}\n$.create=function(params){var doc=(params.win||window).document;if(!params){params='div';}\nif(typeof params=='string'){return doc.createElement(params);}\nvar el=doc.createElement(params.tag||'div');if(params.style){$.style(el,params.style);}\nif(params.attrs){for(attr in params.attrs){el.setAttribute(attr,params.attrs[attr]);}}\nif(params['class']||params['className']){el.className=params['class']||params['className'];}\nif(params.parent){params.parent.appendChild(el);}\nif(params.html){el.innerHTML=params.html;}\nif(params.text){$.setText(el,params.text);}\nreturn el;}\n$.show=function(el,how){$.id(el).style.display=how||'block';}\n$.hide=function(el){$.id(el).style.display='none';}\n$.addClass=function(el,classNames){var el=$.id(el);if(typeof classNames==\"string\"){classNames=classNames.split(' ');}\nvar current=' '+el.className+' ';for(var i=0,len=classNames.length,c;(c=classNames[i])||i<len;++i){if(current.indexOf(' '+c+' ')==-1){current+=c+' ';}}\nel.className=current;return $;}\n$.removeClass=function(el,classNames){var el=$.id(el);el.className=(' '+el.className+' ').replace(' ','  ').replace(new RegExp('( '+classNames.replace(' ',' | ')+' )','g'),'').replace('\\s',' ').replace(/^\\s+|\\s+%/,'');}\n$.style=function(el,style){if(el instanceof Array){for(var i=0,o;o=el[i];++i){$.style(o,style);}\nreturn;}\nel=$.id(el);for(prop in style){switch(prop){case'float':el.style.styleFloat=el.style.float=style[prop];break;case'opacity':el.style.opacity=style[prop];break;default:el.style[prop]=style[prop];break;}}};$.onEvent=function(el,name,f){el=$.id(el);if(el.addEventListener){el.addEventListener(name,f,false);}else{el.attachEvent('on'+name,function(e){var evt=e||window.event;f(evt);});}};$.stopEvent=function(e){e.cancelBubble=true;if(e.stopPropagation)e.stopPropagation();if(e.preventDefault)e.preventDefault();}\n$.setText=function(el,text){el=$.id(el);text=String(text);if('textContent'in el){el.textContent=text;}else if('innerText'in el){el.innerText=text.replace(/\\n/g,' ');}else{el.innerHTML='';el.appendChild(document.createTextNode(text));}}\n$.remove=function(el){el=$.id(el);if(el&&el.parentNode){el.parentNode.removeChild(el);}}"},'jsio.protocols.rtjp':{"url":"jsio/protocols/rtjp.js","src":"\njsio('import Class, bind, jsio.interfaces, logging');jsio('from jsio.protocols.delimited import DelimitedProtocol');var logger=logging.getLogger('RTJPProtocol')\nexports.RTJPProtocol=Class(DelimitedProtocol,function(supr){this.init=function(){var delimiter='\\n';supr(this,'init',[delimiter]);this.frameId=0;}\nthis.connectionMade=function(){logger.debug(\"connectionMade\");}\nvar error=function(e){logger.warn('Error: ',e,e.traceback);}\nthis.frameReceived=function(id,name,args){}\nthis.sendFrame=function(name,args){if(!args){args={}}\nlogger.debug('sendFrame',name,args);this.transport.write(JSON.stringify([++this.frameId,name,args])+'\\r\\n');return this.frameId;}\nthis.lineReceived=function(line){logger.debug(\"lineReceived\",line);try{var frame=JSON.parse(line);if(frame.length!=3){return error.call(this,\"Invalid frame length\");}\nif(typeof(frame[0])!=\"number\"){return error.call(this,\"Invalid frame id\");}\nif(typeof(frame[1])!=\"string\"){return error.call(this,\"Invalid frame name\");}\nif(typeof(frame[2])!=\"object\"){return error.call(this,\"Invalid frame args\");}\nlogger.debug(\"frameReceived:\",frame[0],frame[1],frame[2]);this.frameReceived(frame[0],frame[1],frame[2]);}catch(e){error.call(this,e);}}\nthis.connectionLost=function(){log('conn lost');}});"}};var pre_jsioImport=[];if(typeof exports=='undefined'){var jsio=window.jsio=bind(this,_jsioImport,window,'');}else{var jsio=process.jsio=bind(this,_jsioImport,process,'');}
jsio.__env=typeof(node)!=='undefined'&&node.version?'node':'browser';function bind(context,method){var args=Array.prototype.slice.call(arguments,2);return function(){method=(typeof method=='string'?context[method]:method);return method.apply(context,args.concat(Array.prototype.slice.call(arguments,0)))}};function Class(parent,proto){if(!parent){throw new Error('parent or prototype not provided');}
if(!proto){proto=parent;}
else if(parent instanceof Array){proto.prototype={};for(var i=0,p;p=parent[i];++i){for(var item in p.prototype){if(!(item in proto.prototype)){proto.prototype[item]=p.prototype[item];}}}
parent=parent[0];}else{proto.prototype=parent.prototype;}
var cls=function(){if(this.init){this.init.apply(this,arguments);}}
cls.prototype=new proto(function(context,method,args){var args=args||[];var target=parent;while(target=target.prototype){if(target[method]){return target[method].apply(context,args);}}
throw new Error('method '+method+' does not exist');});cls.prototype.constructor=cls;return cls;}
var modulePathCache={}
var getModulePathPossibilities=function(pathString){var segments=pathString.split('.')
var modPath=segments.join('/');var out;if(segments[0]in modulePathCache){out=[[modulePathCache[segments[0]]+'/'+modPath+'.js',null]];}else{out=[];for(var i=0,path;path=jsio.path[i];++i){out.push([path+'/'+modPath+'.js',path]);}}
return out;}
var strDuplicate=function(str,num){var out="";for(var i=0;i<num;++i){out+=str;}
return out;}
jsio.path=['.'];switch(jsio.__env){case'node':var nodeWrapper={require:require};var stringifyPretty=function(item){return _stringify(true,item,1);}
var stringify=function(item){return _stringify(false,item);}
var _stringify=function(pretty,item,tab){if(item instanceof Array){var str=[];for(var i=0,len=item.length;i<len;++i){str.push(_stringify(pretty,item[i]));}
return'['+str.join(',')+']';}else if(typeof(item)=='object'){var str=[];for(var key in item){var value=key+':'+(pretty?' ':'');if(typeof item[key]=='function'){var def=item[key].toString();var match=def.match(/^function\s+\((.*?)\)/);value+=match?'f('+match[1]+') {...}':'[Function]';}else{value+=_stringify(pretty,item[key],tab+1);}
str.push(value);}
if(pretty&&str.length>1){var spacer=strDuplicate('\t',tab);return'{\n'+spacer+str.join(',\n'+spacer)+'\n'+strDuplicate('\t',tab-1)+'}';}else{return'{'+str.join(',')+'}';}}
return item+"";}
var log=function(){node.stdio.writeError(Array.prototype.slice.call(arguments,0).map(stringifyPretty).join(' ')+"\n");}
window=process;var compile=function(context,args){node.compile("function fn(_) { with(_){delete _;(function(){"+args.src+"\n}).call(this)}}",args.url);try{fn.call(context.exports,context);}catch(e){if(e.type=="stack_overflow"){log("Stack overflow in",args.url,e);}else{log("error when loading",args.url);}
throw e;}
return true;}
var windowCompile=function(context,args){var fn=node.compile("function(_){with(_){with(_.window){delete _;(function(){"+args.src+"\n}).call(this)}}}",args.url);fn.call(context.exports,context);}
var cwd=node.cwd();var makeRelative=function(path){var i=path.match('^'+cwd);if(i&&i[0]==cwd){var offset=path[cwd.length]=='/'?1:0
return path.slice(cwd.length+offset);}
return path;}
var getModuleSourceAndPath=function(pathString){var baseMod=pathString.split('.')[0];var urls=getModulePathPossibilities(pathString);var cwd=node.cwd()+'/';for(var i=0,url;url=urls[i];++i){var cachePath=url[1];var url=url[0];try{var out={src:node.fs.cat(url,"utf8").wait(),url:url};if(!(baseMod in modulePathCache)){modulePathCache[baseMod]=cachePath;}
return out;}catch(e){}}
throw new Error("Module not found: "+pathString+"\n(looked in "+urls+")");}
var segments=__filename.split('/');var jsioPath=segments.slice(0,segments.length-2).join('/');if(jsioPath){jsio.path.push(jsioPath);modulePathCache.jsio=jsioPath;}else{modulePathCache.jsio='.';}
jsio.__path=makeRelative(process.ARGV[1]);break;default:var log=function(){if(typeof console!='undefined'&&console.log){console.log.apply(console,arguments);}else{var shouldScroll=document.body.scrollHeight==document.body.scrollTop+document.body.clientHeight;var d=document.createElement('div');document.body.appendChild(d);out=[]
for(var i=0,item;(item=arguments[i])||i<arguments.length;++i){out.push(JSON.stringify(item));}
d.innerHTML=out.join(", ");if(shouldScroll){window.scrollTo(0,10000);}}}
var compile=function(context,args){var code="var fn = function(_){with(_){delete _;(function(){"+args.src+"\n}).call(this)}}\n//@ sourceURL="+args.url;try{eval(code);}catch(e){if(e instanceof SyntaxError){var src='javascript:document.open();document.write("<scr"+"ipt src=\''+args.url+'\'></scr"+"ipt>")';var callback=function(){var el=document.createElement('iframe');with(el.style){position='absolute';top=left='-999px';width=height='1px';visibility='hidden';}
el.src=src;setTimeout(function(){document.body.appendChild(el);},0);}
if(document.body){callback();}
else{window.addEventListener('load',callback,false);}
throw new Error("forcing halt on load of "+args.url);}
throw e;}
try{fn.call(context.exports,context);}catch(e){log('error when loading '+args.url);throw e;}
return true;}
var windowCompile=function(context,args){var f="var fn = function(_){with(_){with(_.window){delete _;(function(){"+args.src+"\n}).call(this)}}}\n//@ sourceURL="+args.url;eval(f);fn.call(context.exports,context);}
var createXHR=function(){return window.XMLHttpRequest?new XMLHttpRequest():window.ActiveXObject?new ActiveXObject("Msxml2.XMLHTTP"):null;}
var getModuleSourceAndPath=function(pathString){if(preloaded_source[pathString]){return preloaded_source[pathString];}
var baseMod=pathString.split('.')[0];var urls=getModulePathPossibilities(pathString);for(var i=0,url;url=urls[i];++i){var cachePath=url[1];var url=url[0];var xhr=createXHR();var failed=false;try{xhr.open('GET',url,false);xhr.send(null);}catch(e){failed=true;}
if(failed||xhr.status==404||xhr.status==-1100||false)
{continue;}
if(!(baseMod in modulePathCache)){modulePathCache[baseMod]=cachePath;}
return{src:xhr.responseText,url:url};}
throw new Error("Module not found: "+pathString+" (looked in "+urls.join(', ')+")");}
try{var scripts=document.getElementsByTagName('script');for(var i=0,script;script=scripts[i];++i){if(/jsio\/jsio\.js$/.test(script.src)){var segments=script.src.split('/');var jsioPath=segments.slice(0,segments.length-2).join('/')||'.';jsio.path.push(jsioPath);modulePathCache.jsio=jsioPath;break;}}}catch(e){}
var cwd=jsio.path[jsio.path.length-1];var makeRelative=function(path){return path.replace(cwd+'/','').replace(cwd,'');}
jsio.__path=makeRelative(window.location.toString());break;}
jsio.basePath=jsio.path[jsio.path.length-1];var modules={bind:bind,Class:Class,log:log,jsio:jsio};function resolveRelativePath(pkg,path){if(pkg.charAt(0)=='.'){pkg=pkg.substring(1);var segments=path.split('.');while(pkg.charAt(0)=='.'){pkg=pkg.slice(1);segments.pop();}
var prefix=segments.join('.');if(prefix){return prefix+'.'+pkg;}}
return pkg;}
function _jsioImport(context,path,what){var match,imports=[];if((match=what.match(/^(from|external)\s+([\w.$]+)\s+import\s+(.*)$/))){imports[0]={from:resolveRelativePath(match[2],path),external:match[1]=='external',"import":{}};match[3].replace(/\s*([\w.$*]+)(?:\s+as\s+([\w.$]+))?/g,function(_,item,as){imports[0]["import"][item]=as||item;});}else if((match=what.match(/^import\s+(.*)$/))){match[1].replace(/\s*([\w.$]+)(?:\s+as\s+([\w.$]+))?,?/g,function(_,pkg,as){fullPkg=resolveRelativePath(pkg,path);imports[imports.length]=as?{from:fullPkg,as:as}:{from:fullPkg,as:pkg};});}else{if(SyntaxError){throw new SyntaxError(what);}else{throw new Error("Syntax error: "+what);}}
for(var i=0,item,len=imports.length;(item=imports[i])||i<len;++i){var pkg=item.from;var segments=pkg.split('.');if(!(pkg in modules)){try{var result=getModuleSourceAndPath(pkg);}catch(e){log('Error:',context.jsio.__path,'could not execute: "'+what+'"');throw e;}
var newRelativePath=segments.slice(0,segments.length-1).join('.');var newContext={};if(!item.external){newContext.exports={};newContext.global=window;newContext.jsio=bind(this,_jsioImport,newContext,newRelativePath);for(var j in modules.jsio){newContext.jsio[j]=modules.jsio[j];}
var tmp=result.url.split('/');newContext.jsio.__dir=makeRelative(tmp.slice(0,tmp.length-1).join('/'));newContext.jsio.__path=makeRelative(result.url);newContext.jsio.__env=jsio.__env;newContext.jsio.node=nodeWrapper;compile(newContext,result);modules[pkg]=newContext.exports;}else{newContext['window']={};for(var j in item["import"]){newContext['window'][j]=null;}
windowCompile(newContext,result);modules[pkg]=newContext.window;}}
if(item.as){var segments=item.as.match(/^\.*(.*?)\.*$/)[1].split('.');var c=context;for(var k=0,len=segments.length-1,segment;(segment=segments[k])&&k<len;++k){if(!segment)continue;if(!c[segment]){c[segment]={};}
c=c[segment];}
c[segments[len]]=modules[pkg];}else if(item["import"]){if(item["import"]['*']){for(var i in modules[pkg]){context[i]=modules[pkg][i];}}else{try{for(var j in item["import"]){context[item["import"][j]]=modules[pkg][j];}}catch(e){log('module: ',modules);throw e;}}}}}
var _localContext={};var _jsio=_localContext.jsio=bind(this,_jsioImport,_localContext,'jsio');_jsio('import jsio.env');jsio.listen=function(server,transportName,opts){var listenerClass=_jsio.env.getListener(transportName);var listener=new listenerClass(server,opts);listener.listen();return listener;}
jsio.connect=function(protocolInstance,transportName,opts){var connector=new(_jsio.env.getConnector(transportName))(protocolInstance,opts);connector.connect();return connector;}
jsio.quickServer=function(protocolClass){_jsio('import .interfaces');return new jsio.interfaces.Server(protocolClass);}
for(var i=0,target;target=pre_jsioImport[i];++i){jsio.require(target);}})();"use strict";if(!this.JSON){this.JSON={};}
(function(){function f(n){return n<10?'0'+n:n;}
if(typeof Date.prototype.toJSON!=='function'){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+'-'+
f(this.getUTCMonth()+1)+'-'+
f(this.getUTCDate())+'T'+
f(this.getUTCHours())+':'+
f(this.getUTCMinutes())+':'+
f(this.getUTCSeconds())+'Z':null;};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf();};}
var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={'\b':'\\b','\t':'\\t','\n':'\\n','\f':'\\f','\r':'\\r','"':'\\"','\\':'\\\\'},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==='string'?c:'\\u'+('0000'+a.charCodeAt(0).toString(16)).slice(-4);})+'"':'"'+string+'"';}
function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==='object'&&typeof value.toJSON==='function'){value=value.toJSON(key);}
if(typeof rep==='function'){value=rep.call(holder,key,value);}
switch(typeof value){case'string':return quote(value);case'number':return isFinite(value)?String(value):'null';case'boolean':case'null':return String(value);case'object':if(!value){return'null';}
gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==='[object Array]'){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||'null';}
v=partial.length===0?'[]':gap?'[\n'+gap+
partial.join(',\n'+gap)+'\n'+
mind+']':'['+partial.join(',')+']';gap=mind;return v;}
if(rep&&typeof rep==='object'){length=rep.length;for(i=0;i<length;i+=1){k=rep[i];if(typeof k==='string'){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}else{for(k in value){if(Object.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?': ':':')+v);}}}}
v=partial.length===0?'{}':gap?'{\n'+gap+partial.join(',\n'+gap)+'\n'+
mind+'}':'{'+partial.join(',')+'}';gap=mind;return v;}}
if(typeof JSON.stringify!=='function'){JSON.stringify=function(value,replacer,space){var i;gap='';indent='';if(typeof space==='number'){for(i=0;i<space;i+=1){indent+=' ';}}else if(typeof space==='string'){indent=space;}
rep=replacer;if(replacer&&typeof replacer!=='function'&&(typeof replacer!=='object'||typeof replacer.length!=='number')){throw new Error('JSON.stringify');}
return str('',{'':value});};}
if(typeof JSON.parse!=='function'){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==='object'){for(k in value){if(Object.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v;}else{delete value[k];}}}}
return reviver.call(holder,key,value);}
cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return'\\u'+
('0000'+a.charCodeAt(0).toString(16)).slice(-4);});}
if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,'@').replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,']').replace(/(?:^|:|,)(?:\s*\[)+/g,''))){j=eval('('+text+')');return typeof reviver==='function'?walk({'':j},''):j;}
throw new SyntaxError('JSON.parse');};}}());