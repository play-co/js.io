<html>
 <head>
  <script src="jsio/jsio.js"></script>
  <script src="http://localhost:8000/static/Orbited.js"></script>
  <script>
   ConsoleClient = jsio.Class(jsio.interfaces.Protocol, function() {
   
	   	var parity = true;
        this.init = function() {
            c = this;
        }
        this.connectionMade = function() {
            document.getElementById('con').style.display = 'block';
            document.getElementById('inputArea').style.display = 'block';
        }
        this.connectionLost = function(reason) {
            console.log('connection lost', reason);
        }
        this.dataReceived = function(data) {
            console.log('data received:', data);

            var line = document.getElementById('con').insertBefore(document.createElement('div'), document.getElementById('con').firstChild);
            line.innerHTML = data;
            line.style.backgroundColor = parity ? '#EEE' : '#F5F5F4';
            parity = !parity;
        }

        this.write = function(data) { this.transport.write(data); }
    });
  </script>
  <style>
  	.connectBtn { float: left; }
  	
  	#con {
  		clear: both;
  		border: 1px solid #CCC;
  	}
  </style>
 </head>
 <body>
 	<div id="wrapper">
 		<div id="inputArea" style="display:none; float:left"></div>
 	 	<div id="con" style="display:none"><br></div>
	</div>
 	<script>
 		var wrapper = document.getElementById('wrapper');
 		var inputArea = document.getElementById('inputArea');
 		var con = document.getElementById('con');
 		var connectBtn = wrapper.insertBefore(document.createElement('button'), inputArea);
	    connectBtn.innerHTML = 'connect';
	    connectBtn.onclick = connect;
	    connectBtn.className = 'connectBtn';
 		
 		var client;
 		function connect() {
			var match = window.location.search.substring(1).match('^(.*&)?protocol=([^&]*)');
			var protocol = match ? match[2] : 'tcp';
			
		    client = jsio.connect(ConsoleClient, protocol, {host: "localhost", port: 5555});
		    connectBtn.innerHTML = 'disconnect';
		    connectBtn.onclick = disconnect;
		};
		
		function disconnect() {
		    connect.innerHTML = 'connect';
		    connect.onclick = connect;
		    client.getProtocol().transport.loseConnection();
		}
		
		var input = inputArea.appendChild(document.createElement('input'));
		input.type = 'text';
		input.onkeypress = function(e) { if((e || event).keyCode == 13) { send(); }}

		var sendBtn = inputArea.appendChild(document.createElement('button'));
		sendBtn.innerHTML = 'send';
		sendBtn.onclick = send;
		
		function send() {
			client.getProtocol().write(input.value);
			input.value = '';
			input.focus();
		}
		
 	</script>
 </body>
</html>
